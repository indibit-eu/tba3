openapi: 3.1.0
info:
  title: TBA III
  summary: Schnittstelle für den Zugriff auf Auswertungsdaten von VERA
  description: >-
    Diese API ermöglicht den Zugriff auf Auswertungsdaten von VERA. Sie bietet
    Endpunkte für die Abfrage von Leistungsdaten auf verschiedenen Ebenen
    (Lerngruppe, Schule, Bundesland) und für verschiedene Arten von Daten
    (Kompetenzstufen, Item-Statistiken, Aggregationen).
  version: '1.0'
  license:
    name: MIT
    url: https://opensource.org/license/MIT
tags:
  - name: groups
    description: Ergebnisse auf Ebene einer Lerngruppe
  - name: schools
    description: Ergebnisse zusammengefasst nach Schule
  - name: states
    description: Ergebnisse auf Landesebene
paths:
  /groups/{id}/competence-levels:
    get:
      description: Kompetenzstufenverteilung in der Lerngruppe
      tags:
        - groups
      parameters:
        - $ref: '#/components/parameters/groupId'
        - $ref: '#/components/parameters/type'
        - $ref: '#/components/parameters/comparison'
      responses:
        '200':
          $ref: '#/components/responses/competence-levels'
        '404':
          description: >-
            Lerngruppe oder Kompetenzstufenverteilung für die Lerngruppe nicht
            gefunden
  /groups/{id}/items:
    get:
      description: Lösungshäufigkeiten je Item in der Lerngruppe
      tags:
        - groups
      parameters:
        - $ref: '#/components/parameters/groupId'
        - $ref: '#/components/parameters/type'
        - $ref: '#/components/parameters/comparison'
      responses:
        '200':
          $ref: '#/components/responses/items'
        '404':
          description: >-
            Lerngruppe oder Lösungshäufigkeiten für die Lerngruppe nicht
            gefunden
  /groups/{id}/aggregations:
    get:
      description: Aggregierte Lösungshäufigkeiten in der Lerngruppe
      tags:
        - groups
      parameters:
        - $ref: '#/components/parameters/groupId'
        - $ref: '#/components/parameters/type'
        - $ref: '#/components/parameters/aggregation'
        - $ref: '#/components/parameters/comparison'
      responses:
        '200':
          $ref: '#/components/responses/aggregations'
        '400':
          description: >-
            Lerngruppe oder Lösungshäufigkeiten für die Lerngruppe nicht
            gefunden
  /schools/{id}/competence-levels:
    get:
      description: Kompetenzstufenverteilung an der Schule
      tags:
        - schools
      parameters:
        - $ref: '#/components/parameters/schoolId'
        - $ref: '#/components/parameters/comparison'
      responses:
        '200':
          $ref: '#/components/responses/competence-levels'
        '404':
          description: Schule oder Kompetensstufenverteilung für die Schule nicht gefunden
  /schools/{id}/items:
    description: Lösungshäufigkeiten je Item an der Schule
    get:
      tags:
        - schools
      parameters:
        - $ref: '#/components/parameters/schoolId'
        - $ref: '#/components/parameters/comparison'
      responses:
        '200':
          $ref: '#/components/responses/items'
        '404':
          description: Schule oder Lösungshäufigkeit je Item für die Schule nicht gefunden
  /schools/{id}/aggregations:
    get:
      description: Aggregierte Lösungshäufigkeiten an der Schule
      tags:
        - schools
      parameters:
        - $ref: '#/components/parameters/schoolId'
        - $ref: '#/components/parameters/type'
        - $ref: '#/components/parameters/aggregation'
        - $ref: '#/components/parameters/comparison'
      responses:
        '200':
          $ref: '#/components/responses/aggregations'
        '404':
          description: >-
            Schule oder Lösungshäufigkeit je Merkmal für die Schule nicht
            gefunden
  /states/{id}/competence-levels:
    get:
      description: Kompetenzstufenverteilung im Bundesland
      tags:
        - states
      parameters:
        - $ref: '#/components/parameters/stateId'
        - $ref: '#/components/parameters/comparison'
      responses:
        '200':
          $ref: '#/components/responses/competence-levels'
        '404':
          description: >-
            Bundesland oder Kompetensstufenverteilung für das Bundesland nicht
            gefunden
  /states/{id}/items:
    get:
      description: Lösungshäufigkeiten je Item im Bundesland
      tags:
        - states
      parameters:
        - $ref: '#/components/parameters/stateId'
        - $ref: '#/components/parameters/comparison'
      responses:
        '200':
          $ref: '#/components/responses/items'
        '404':
          description: >-
            Bundesland oder Lösungshäufigkeit je Item für das Bundesland nicht
            gefunden
  /states/{id}/aggregations:
    get:
      description: Aggregierte Lösungshäufigkeiten im Bundesland
      tags:
        - states
      parameters:
        - $ref: '#/components/parameters/stateId'
        - $ref: '#/components/parameters/type'
        - $ref: '#/components/parameters/aggregation'
        - $ref: '#/components/parameters/comparison'
      responses:
        '200':
          $ref: '#/components/responses/aggregations'
        '404':
          description: >-
            Bundesland oder Lösungshäufigkeit je Merkmal für das Bundesland
            nicht gefunden
components:
  parameters:
    groupId:
      in: path
      name: id
      required: true
      schema:
        type: string
      description: Id der Lerngruppe
      examples:
        Deutsch Grundschule (mittel):
          value: 3a-deutsch
          description: Lerngruppe 3a (mittel), Fach Deutsch
        Deutsch Grundschule (gut):
          value: 3b-deutsch
          description: Lerngruppe 3b (gut), Fach Deutsch
        Deutsch Grundschule (schlecht):
          value: 3c-deutsch
          description: Lerngruppe 3c (schlecht), Fach Deutsch
        Mathematik Grundschule (mittel):
          value: 3a-mathe
          description: Lerngruppe 3a (mittel), Fach Mathematik
        Mathematik Grundschule (gut):
          value: 3b-mathe
          description: Lerngruppe 3b (gut), Fach Mathematik
        Mathematik Grundschule (schlecht):
          value: 3c-mathe
          description: Lerngruppe 3c (schlecht), Fach Mathematik
        Deutsch (mittel):
          value: 8a-deutsch
          description: Lerngruppe 8a (mittel), Fach Deutsch
        Deutsch (gut):
          value: 8b-deutsch
          description: Lerngruppe 8b (gut), Fach Deutsch
        Deutsch (schlecht):
          value: 8c-deutsch
          description: Lerngruppe 8c (schlecht), Fach Deutsch
        Englisch (mittel):
          value: 8a-englisch
          description: Lerngruppe 8a (mittel), Fach Englisch
        Englisch (gut):
          value: 8b-englisch
          description: Lerngruppe 8b (gut), Fach Englisch
        Englisch (schlecht):
          value: 8c-englisch
          description: Lerngruppe 8c (schlecht), Fach Englisch
        Mathematik (mittel):
          value: 8a-mathe
          description: Lerngruppe 8a (mittel), Fach Mathematik
        Mathematik (gut):
          value: 8b-mathe
          description: Lerngruppe 8b (gut), Fach Mathematik
        Mathematik (schlecht):
          value: 8c-mathe
          description: Lerngruppe 8c (schlecht), Fach Mathematik
    type:
      in: query
      name: type
      explode: false
      schema:
        type: string
      description: >-
        Wertegruppen, welche zusätzlich zur Standardgruppe ausgegeben werden
        sollen
      examples:
        Schüler:
          value: students
          description: Liefert Leistungsdaten auf Schülerebene.
        Lerngruppe und Schüler:
          value: group,students
          description: Liefert Leistungsdaten auf Gruppen- und Schülerebene.
    comparison:
      in: query
      name: comparison
      explode: false
      schema:
        type: string
      description: Filter für bestimmte Vergleichsgruppen, die ausgegeben werden sollen
    aggregation:
      in: query
      name: aggregation
      explode: false
      schema:
        type: string
      description: Aggregationsarten, die berechnet werden sollen
    schoolId:
      in: path
      name: id
      required: true
      schema:
        type: string
      description: Id der Schule
      examples:
        Grundschule:
          value: gs-musterstadt
          description: Beispielhafte Grundschule
        Gymnasium:
          value: gym-beispielstadt
          description: Beispielhaftes Gymnasium
    stateId:
      in: path
      name: id
      required: true
      schema:
        type: string
      description: Id des Bundeslandes
  schemas:
    domain:
      type: object
      required:
        - name
      properties:
        id:
          type: string
          examples:
            - 4ddfdc3e-79fd-47be-bbc0-341f403ac5db
        name:
          type: string
          description: Name der Domäne
          examples:
            - Deutsch Leseverständnis
            - Mathematik
        subject:
          type: object
          description: Fach der Domäne
          required:
            - name
          properties:
            id:
              type: string
              examples:
                - d4a78f30-bf14-475d-8f81-a7ee98b5db4f
            name:
              type: string
              description: Name des Fachs
              examples:
                - Deutsch
                - Mathematik
    language-at-home-characteristic:
      type: object
      required:
        - type
        - value
      properties:
        type:
          type: string
          enum:
            - languageAtHome
          description: Type of characteristic
        label:
          type: string
          description: Label for the characteristic
          examples:
            - Language at Home
            - Sprache zu Hause
        value:
          type: string
          description: Specific value of the characteristic
          examples:
            - german
            - other
    gender-characteristic:
      type: object
      required:
        - type
        - value
      properties:
        type:
          type: string
          enum:
            - gender
          description: Type of characteristic
        label:
          type: string
          description: Label for the characteristic
          examples:
            - Gender
            - Geschlecht
        value:
          type: string
          description: Specific value of the characteristic
          examples:
            - male
            - female
            - diverse
    other-characteristic:
      type: object
      required:
        - type
        - value
      properties:
        type:
          type: string
          description: Type of characteristic (fallback for any other type)
          examples:
            - SES
            - schoolType
        label:
          type: string
          description: Label for the characteristic
          examples:
            - Socioeconomic Status
            - School Type
        value:
          type: string
          description: Specific value of the characteristic
          examples:
            - high
            - low
            - gymnasium
    characteristic:
      oneOf:
        - $ref: '#/components/schemas/language-at-home-characteristic'
        - $ref: '#/components/schemas/gender-characteristic'
        - $ref: '#/components/schemas/other-characteristic'
      discriminator:
        propertyName: type
        mapping:
          languageAtHome: '#/components/schemas/language-at-home-characteristic'
          gender: '#/components/schemas/gender-characteristic'
          other: '#/components/schemas/other-characteristic'
    covariates:
      type: array
      description: Kovariaten der Testgruppe
      items:
        $ref: '#/components/schemas/characteristic'
    value-group:
      type: object
      required:
        - name
      properties:
        id:
          type: string
          examples:
            - 32fbeb80-224a-4d13-a23c-0eec6c0d3ea7
        name:
          type: string
          description: Bezeichnung der Wertegruppe
          examples:
            - Klasse 8a
            - Schüler 1
            - Korrigierter Landesmittelwert
        domain:
          $ref: '#/components/schemas/domain'
          description: Domäne der Wertegruppe (optional)
        covariates:
          $ref: '#/components/schemas/covariates'
          description: Kovariaten der Wertegruppe
        attributes:
          type: array
          description: Liste von Key-Value-Werten mit zusätzlichen Informationen
          items:
            type: object
            required:
              - key
              - value
            properties:
              key:
                type: string
              value:
                type: string
    competence-level:
      type: object
      required:
        - nameShort
      properties:
        id:
          type: string
          examples:
            - 18488a76-0cb6-4d16-9f7b-d2c69f73e058
        name:
          type: string
          description: Name der Komptenzstufe
          examples:
            - Optimalstandard
            - Regularstandard
        nameShort:
          type: string
          description: Kürzel der Kompetenzstufe
          examples:
            - V
            - Ia
            - A2.1
        description:
          type: string
          description: Beschreibung der Kompetenzstufe
          examples:
            - >-
              Kann Aussagen zu zentralen Aspekten des Textes selbstständig
              begründen
    item-parameters:
      type: object
      description: >-
        (importierte) Itemparameter aus den Itemkennwerten des IQB. Bisher
        unvollständige, exemplarische Liste.
      properties:
        logit:
          description: Schwierigkeit des Items in Logit
          type: number
        bistaPoints:
          description: >-
            Schwierigkeit des Items in Punkten nach deutscher
            Bildungsstandardmetrik
          type: number
        solutionFrequencyGymnasium:
          description: Mittlere Lösungshäufigkeit der Pilotierung an Gymnasien
          type: number
        solutionFrequencyNonGymnasium:
          description: Mittlere Lösungshäufigkeit der Pilotierung an Nicht-Gymnasien
          type: number
        solutionFrequencyPrimarySchool:
          description: Mittlere Lösungshäufigkeit der Pilotierung an Grundschulen
          type: number
        subject:
          description: Fach des Items
          type: string
        domain:
          description: Kompetenzbereich des Items
          type: string
        competenceLevel:
          description: Kompetenzstufe des Items
          $ref: '#/components/schemas/competence-level'
        cognitiveDemandLevel:
          description: Anforderungsbereich des Items
          type: string
        generalMathematicalCompetence:
          description: Allgemeine Kompetenz des Items
          type: array
          items:
            type: string
        coreIdea:
          description: Leitideen des Items
          type: array
          items:
            type: string
        competenceStandard:
          description: Liste der dem Item zugeordneten Kompetenzstandards
          type: array
          items:
            type: string
        listeningOrReadingStyle:
          description: Hör- / Lesestil
          type: string
          enum:
            - selektiv
            - detailliert
            - inferierend
            - global
    item:
      type: object
      required:
        - name
        - iqbId
      properties:
        id:
          type: string
          examples:
            - b8d23653-3881-40de-a45a-d34e2dd191ed
        name:
          type: string
          description: Bezeichnung des Items im Testheft
          examples:
            - '2.1'
            - '2.2'
        iqbId:
          type: string
          description: IQB Item-Id des Items
          examples:
            - AB1021
            - AB1022
        parameters:
          $ref: '#/components/schemas/item-parameters'
    descriptive-statistics:
      type: object
      properties:
        total:
          type: integer
          description: Gesamtzahl der Items
          examples:
            - 4
        mean:
          type: number
          description: Anteil richtig gelöster Items / Mittlere Lösungsquote
          minimum: 0
          maximum: 1
          examples:
            - 0.75
        frequency:
          type: integer
          description: Absolute Anzahl richtig gelöster Items
          examples:
            - 3
        standardDeviation:
          type: number
          description: Standardabweichung der mittleren Lösungsquote
    item-statistics:
      type: array
      items:
        allOf:
          - $ref: '#/components/schemas/item'
          - type: object
            properties:
              descriptiveStatistics:
                $ref: '#/components/schemas/descriptive-statistics'
  responses:
    competence-levels:
      description: Kompetenzstufenverteilung im Kontext
      content:
        application/json:
          schema:
            type: array
            items:
              allOf:
                - $ref: '#/components/schemas/value-group'
                - type: object
                  required:
                    - competenceLevels
                  properties:
                    competenceLevels:
                      type: array
                      description: Kompetenzstufenverteilung in der Wertegruppe
                      items:
                        allOf:
                          - $ref: '#/components/schemas/competence-level'
                          - type: object
                            required:
                              - frequency
                            properties:
                              frequency:
                                type: integer
    items:
      description: Lösungshäufigkeiten der Items im Kontext
      content:
        application/json:
          schema:
            type: array
            items:
              allOf:
                - $ref: '#/components/schemas/value-group'
                - type: object
                  properties:
                    items:
                      $ref: '#/components/schemas/item-statistics'
                      description: Statistiken für einzelne Items
    aggregations:
      description: Lösungshäufigkeiten der Merkmale im Kontext
      content:
        application/json:
          schema:
            type: array
            items:
              allOf:
                - $ref: '#/components/schemas/value-group'
                - type: object
                  required:
                    - aggregations
                  properties:
                    aggregations:
                      type: array
                      description: Einzelne Aggregationen
                      items:
                        type: object
                        properties:
                          type:
                            type: string
                            description: >-
                              Aggregationsart (z.B. Kompetenzstandard, Aufgabe),
                              eigene Aggregationsarten können definiert werden.
                            enum:
                              - competenceStandard
                              - custom
                            examples:
                              - competenceStandard
                              - total
                          value:
                            type: string
                            description: >-
                              Einzelne aggregierte Gruppe, z.B. "Leseverstehen"
                              und "Orthografie" bei Domänen.
                            examples:
                              - 2.5.3
                          descriptiveStatistics:
                            $ref: '#/components/schemas/descriptive-statistics'
                          includedIqbIds:
                            type: array
                            description: >-
                              Liste von IQB ItemIds, die in der Berechnung der
                              Aggregation berücksichtigt wurden.
                            items:
                              type: string
