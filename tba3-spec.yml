openapi: 3.1.0
info:
  title: TBA III
  summary: Schnittstelle für den Zugriff auf Auswertungsdaten von VERA
  version: '0.2'
  license:
    name: MIT
    url: https://opensource.org/license/MIT
tags:
  - name: groups
    description: Ergebnisse auf Ebene einer Lerngruppe
  - name: students
    description: Einzelergebnisse der Schüler:innen einer Lerngruppe
  - name: schools
    description: Ergebnisse zusammengefasst nach Schule
  - name: states
    description: Ergebnisse auf Landesebene
paths:
  /groups/{id}/competence-levels:
    get:
      description: Kompetenzstufenverteilung in der Lerngruppe
      tags:
        - groups
      parameters:
        - $ref: '#/components/parameters/groupId'
        - $ref: '#/components/parameters/comparison'
      responses:
        '200':
          $ref: '#/components/responses/competence-levels'
        '404':
          description: >-
            Lerngruppe oder Kompetenzstufenverteilung für die Lerngruppe nicht
            gefunden
  /groups/{id}/items:
    get:
      description: Lösungshäufigkeiten je Item in der Lerngruppe
      tags:
        - groups
      parameters:
        - $ref: '#/components/parameters/groupId'
        - $ref: '#/components/parameters/comparison'
      responses:
        '200':
          $ref: '#/components/responses/items'
        '404':
          description: >-
            Lerngruppe oder Lösungshäufigkeiten für die Lerngruppe nicht
            gefunden
  /groups/{id}/aggregations:
    get:
      description: >-
        Lösungshäufigkeiten je Merkmal-Ausprägung in der Lerngruppe, z.B.
        Kompetenzen, Anforderungsbereiche, Geschlecht, ...
      tags:
        - groups
      parameters:
        - $ref: '#/components/parameters/groupId'
        - $ref: '#/components/parameters/type'
        - $ref: '#/components/parameters/comparison'
      responses:
        '200':
          $ref: '#/components/responses/aggregations'
        '400':
          description: >-
            Lerngruppe oder Lösungshäufigkeiten für die Lerngruppe nicht
            gefunden
  /groups/{id}/students/competence-levels:
    description: Kompetenzstufe je Schüler:in
    get:
      tags:
        - students
      parameters:
        - $ref: '#/components/parameters/groupId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  allOf:
                    - $ref: '#/components/schemas/domain'
                    - type: object
                      required:
                        - students
                      properties:
                        students:
                          type: array
                          items:
                            allOf:
                              - $ref: '#/components/schemas/student'
                              - type: object
                                required:
                                  - competenceLevel
                                properties:
                                  kompetenzstufe:
                                    $ref: '#/components/schemas/competence-level'
        '404':
          description: >-
            Lerngruppe oder Kompetenz für die Schüler:innen der Lerngruppe nicht
            gefunden
  /groups/{id}/students/items:
    description: Lösungsquote je Schüler:in und Item
    get:
      tags:
        - students
      parameters:
        - $ref: '#/components/parameters/groupId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  allOf:
                    - $ref: '#/components/schemas/domain'
                    - type: object
                      required:
                        - students
                      properties:
                        students:
                          type: array
                          items:
                            allOf:
                              - $ref: '#/components/schemas/student'
                              - type: object
                                required:
                                  - items
                                properties:
                                  items:
                                    $ref: '#/components/schemas/item-statistics'
        '404':
          description: >-
            Lerngruppe oder Lösungshäufigkeiten für die Schüler:innen der
            Lerngruppe nicht gefunden
  /groups/{id}/students/aggregations:
    get:
      description: >-
        Lösungshäufigkeiten je Merkmal-Ausprägung in der Lerngruppe, z.B.
        Kompetenzen, Anforderungsbereiche, Geschlecht, ...
      tags:
        - students
      parameters:
        - $ref: '#/components/parameters/groupId'
        - $ref: '#/components/parameters/type'
        - $ref: '#/components/parameters/comparison'
      responses:
        '200':
          description: Lösungshäufigkeiten der Merkmale im Kontext
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    type:
                      type: string
                      description: >-
                        Aggregationsart (z.B. Domäne, Kompetenzstandard), eigene
                        Aggregationsarten können definiert werden.
                      enum:
                        - total
                        - domain
                        - competenceStandard
                        - custom
                    value:
                      type: string
                      description: >-
                        Einzelne aggregierte Gruppe, z.B. "Leseverstehen" und
                        "Orthografie" bei Domänen.
                    students:
                      type: array
                      items:
                        allOf:
                          - $ref: '#/components/schemas/student'
                          - type: object
                            properties:
                              descriptiveStatistics:
                                $ref: '#/components/schemas/descriptive-statistics'
                              comparison:
                                $ref: '#/components/schemas/comparison'
        '400':
          description: >-
            Lerngruppe oder Lösungshäufigkeiten für die Lerngruppe nicht
            gefunden
  /schools/{id}/competence-levels:
    get:
      description: Kompetenzstufenverteilung an der Schule
      tags:
        - schools
      parameters:
        - $ref: '#/components/parameters/schoolId'
        - $ref: '#/components/parameters/comparison'
      responses:
        '200':
          $ref: '#/components/responses/competence-levels'
        '404':
          description: Schule oder Kompetensstufenverteilung für die Schule nicht gefunden
  /schools/{id}/items:
    description: Lösungshäufigkeiten je Item an der Schule
    get:
      tags:
        - schools
      parameters:
        - $ref: '#/components/parameters/schoolId'
        - $ref: '#/components/parameters/comparison'
      responses:
        '200':
          $ref: '#/components/responses/items'
        '404':
          description: Schule oder Lösungshäufigkeit je Item für die Schule nicht gefunden
  /schools/{id}/aggregations:
    get:
      description: Lösungshäufigkeiten je Merkmal-Ausprägung an der Schule
      tags:
        - schools
      parameters:
        - $ref: '#/components/parameters/schoolId'
        - $ref: '#/components/parameters/type'
        - $ref: '#/components/parameters/comparison'
      responses:
        '200':
          $ref: '#/components/responses/aggregations'
        '404':
          description: >-
            Schule oder Lösungshäufigkeit je Merkmal für die Schule nicht
            gefunden
  /states/{id}/competence-levels:
    get:
      description: Kompetenzstufenverteilung im Bundesland
      tags:
        - states
      parameters:
        - $ref: '#/components/parameters/stateId'
        - $ref: '#/components/parameters/comparison'
      responses:
        '200':
          $ref: '#/components/responses/competence-levels'
        '404':
          description: >-
            Bundesland oder Kompetensstufenverteilung für das Bundesland nicht
            gefunden
  /states/{id}/items:
    get:
      description: Lösungshäufigkeiten je Item im Bundesland
      tags:
        - states
      parameters:
        - $ref: '#/components/parameters/stateId'
        - $ref: '#/components/parameters/comparison'
      responses:
        '200':
          $ref: '#/components/responses/items'
        '404':
          description: >-
            Bundesland oder Lösungshäufigkeit je Item für das Bundesland nicht
            gefunden
  /states/{id}/aggregations:
    get:
      description: Lösungshäufigkeiten je Merkmal-Ausprägung im Bundesland
      tags:
        - states
      parameters:
        - $ref: '#/components/parameters/stateId'
        - $ref: '#/components/parameters/type'
        - $ref: '#/components/parameters/comparison'
      responses:
        '200':
          $ref: '#/components/responses/aggregations'
        '404':
          description: >-
            Bundesland oder Lösungshäufigkeit je Merkmal für das Bundesland
            nicht gefunden
components:
  parameters:
    groupId:
      in: path
      name: id
      required: true
      schema:
        type: string
      description: Id der Lerngruppe
    comparison:
      in: query
      name: comparison
      explode: false
      schema:
        type: string
      description: Filter für Vergleichsgruppen, die ausgegeben werden sollen
      examples:
        Schulklassen:
          value:
            - 3a
            - 3b
            - 3d
          description: Vergleich mit den Parallelklassen
        Schulklassen (Variante):
          value: parallelklassen
          description: Vergleich mit den Parallelklassen
        Fairer Vergleich:
          value: fair
          description: >-
            Vergleichsgruppen für den fairen Vergleich (Landesmittelwert, fairer
            Vergleichsmittelwert)
    type:
      in: query
      name: type
      explode: false
      schema:
        type: string
      description: Filtert, welche Aggregationen berechnet werden soll
      examples:
        Bildungsstandard:
          value: domain
          description: Aggregation nach Domänen
    schoolId:
      in: path
      name: id
      required: true
      schema:
        type: string
      description: Id der Schule
    stateId:
      in: path
      name: id
      required: true
      schema:
        type: string
      description: Id des Bundeslandes
  schemas:
    domain:
      type: object
      required:
        - name
      properties:
        id:
          type: string
          examples:
            - 4ddfdc3e-79fd-47be-bbc0-341f403ac5db
        name:
          type: string
          description: Name der Domäne
          examples:
            - Deutsch Leseverständnis
            - Mathematik
    competence-level:
      type: object
      required:
        - nameShort
      properties:
        id:
          type: string
          examples:
            - 18488a76-0cb6-4d16-9f7b-d2c69f73e058
        name:
          type: string
          description: Name der Komptenzstufe
          examples:
            - Optimalstandard
            - Regularstandard
        nameShort:
          type: string
          description: Kürzel der Kompetenzstufe
          examples:
            - V
            - Ia
            - A2.1
        description:
          type: string
          description: Beschreibung der Kompetenzstufe
          examples:
            - >-
              Kann Aussagen zu zentralen Aspekten des Textes selbstständig
              begründen
    characteristic:
      type: object
      required:
        - type
        - value
      properties:
        type:
          type: string
          description: Art des Merkmals
          examples:
            - SES
            - geschlecht
        label:
          type: string
          description: Bezeichnung des Merkmals
          examples:
            - Bücherfrage
            - Geschlecht
        value:
          type: string
          description: Konkrete Ausprägung des Merkmals
          examples:
            - niedrig
            - weiblich
    covariates:
      type: array
      description: Kovariaten der Testgruppe
      items:
        $ref: '#/components/schemas/characteristic'
    comparison-group:
      type: object
      required:
        - name
      properties:
        id:
          type: string
          examples:
            - 32fbeb80-224a-4d13-a23c-0eec6c0d3ea7
        name:
          type: string
          description: Bezeichnung der Vergleichsgruppe
          examples:
            - Korrigierter Landesmittelwert
            - Vergleichsschule
            - männlich
            - weiblich
        size:
          type: integer
          description: Größe der Vergleichsgruppe
        covariates:
          $ref: '#/components/schemas/covariates'
    item-parameters:
      type: object
      description: >-
        (importierte) Itemparameter aus den Itemkennwerten des IQB. Bisher
        unvollständige, exemplarische Liste.
      properties:
        logit:
          description: Schwierigkeit des Items in Logit
          type: number
        bistaPoints:
          description: >-
            Schwierigkeit des Items in Punkten nach deutscher
            Bildungsstandardmetrik
          type: number
        solutionFrequencyGymnasium:
          description: Mittlere Lösungshäufigkeit der Pilotierung an Gymnasien
          type: number
        solutionFrequencyNonGymnasium:
          description: Mittlere Lösungshäufigkeit der Pilotierung an Nicht-Gymnasien
          type: number
        solutionFrequencyPrimarySchool:
          description: Mittlere Lösungshäufigkeit der Pilotierung an Grundschulen
          type: number
        subject:
          description: Fach des Items
          type: string
        domain:
          description: Kompetenzbereich des Items
          type: string
        competenceLevel:
          description: Kompetenzstufe des Items
          $ref: '#/components/schemas/competence-level'
        cognitiveDemandLevel:
          description: Anforderungsbereich des Items
          type: string
        generalMathematicalCompetence:
          description: Allgemeine Kompetenz des Items
          type: array
          items:
            type: string
        coreIdea:
          description: Leitideen des Items
          type: array
          items:
            type: string
        competenceStandard:
          description: Liste der dem Item zugeordneten Kompetenzstandards
          type: array
          items:
            type: string
        listeningOrReadingStyle:
          description: Hör- / Lesestil
          type: string
          enum:
            - selektiv
            - detailliert
            - inferierend
            - global
    item:
      type: object
      required:
        - name
        - iqbId
      properties:
        id:
          type: string
          examples:
            - b8d23653-3881-40de-a45a-d34e2dd191ed
        name:
          type: string
          description: Bezeichnung des Items im Testheft
          examples:
            - '2.1'
            - '2.2'
        iqbId:
          type: string
          description: IQB Item-Id des Items
          examples:
            - AB1021
            - AB1022
        parameters:
          $ref: '#/components/schemas/item-parameters'
    descriptive-statistics:
      type: object
      properties:
        total:
          type: integer
          description: Gesamtzahl der Items
          examples:
            - 4
        mean:
          type: number
          description: Anteil richtig gelöster Items / Mittlere Lösungsquote
          minimum: 0
          maximum: 1
          examples:
            - 0.75
        frequency:
          type: integer
          description: Absolute Anzahl richtig gelöster Items
          examples:
            - 3
        standardDeviation:
          type: number
          description: Standardabweichung der mittleren Lösungsquote
    comparison:
      type: array
      description: Vergleichswerte mit Vergleichsgruppen
      items:
        allOf:
          - $ref: '#/components/schemas/comparison-group'
          - type: object
            required:
              - descriptiveStatistics
            properties:
              descriptiveStatistics:
                $ref: '#/components/schemas/descriptive-statistics'
    item-statistics:
      type: array
      items:
        allOf:
          - $ref: '#/components/schemas/item'
          - type: object
            properties:
              descriptiveStatistics:
                $ref: '#/components/schemas/descriptive-statistics'
              comparison:
                $ref: '#/components/schemas/comparison'
    student:
      type: object
      required:
        - name
      properties:
        id:
          type: string
          examples:
            - 0f35f3f0-eb76-4191-9ed3-2d8ea02b79e9
        name:
          type: string
          examples:
            - kopieren.pizza.71
            - buv
            - '9'
        covariates:
          $ref: '#/components/schemas/covariates'
  responses:
    competence-levels:
      description: Kompetenzstufenverteilung im Kontext
      content:
        application/json:
          schema:
            type: array
            items:
              allOf:
                - $ref: '#/components/schemas/domain'
                - type: object
                  required:
                    - competenceLevels
                  properties:
                    competenceLevels:
                      type: array
                      items:
                        allOf:
                          - $ref: '#/components/schemas/competence-level'
                          - type: object
                            required:
                              - frequency
                            properties:
                              frequency:
                                type: integer
                              comparison:
                                type: array
                                items:
                                  allOf:
                                    - $ref: '#/components/schemas/comparison-group'
                                    - type: object
                                      required:
                                        - frequency
                                      properties:
                                        frequency:
                                          type: integer
                                          examples:
                                            - 2
    items:
      description: Lösungshäufigkeiten der Items im Kontext
      content:
        application/json:
          schema:
            type: array
            items:
              allOf:
                - $ref: '#/components/schemas/domain'
                - type: object
                  properties:
                    items:
                      $ref: '#/components/schemas/item-statistics'
    aggregations:
      description: Lösungshäufigkeiten der Merkmale im Kontext
      content:
        application/json:
          schema:
            type: array
            items:
              type: object
              properties:
                type:
                  type: string
                  description: >-
                    Aggregationsart (z.B. Domäne, Kompetenzstandard), eigene
                    Aggregationsarten können definiert werden.
                  enum:
                    - total
                    - domain
                    - competenceStandard
                    - custom
                  examples:
                    - domain
                value:
                  type: string
                  description: >-
                    Einzelne aggregierte Gruppe, z.B. "Leseverstehen" und
                    "Orthografie" bei Domänen.
                  examples:
                    - Leseverstehen
                    - Orthografie
                descriptiveStatistics:
                  $ref: '#/components/schemas/descriptive-statistics'
                comparison:
                  $ref: '#/components/schemas/comparison'
